## 项目总览（明治酸奶资料库 YogWeb）

本项目是一个中文静态网站，聚焦酸奶与乳酸菌的研究与科普，包含研究报告、历史与人物、生活方式与食谱等多栏目内容。代码已完成“现代化与本地化”改造：移除外部依赖、重构 CSS 架构、增加开发服务器与性能模板，保留旧站风格与交互。

### 目录结构
- `index.html`：网站首页
- `laboratory/`：实验室栏目（研究报告、研究者、各地酸奶文化）
- `style/`：风采栏目（美容、科学、早餐“肠食”）
- `common/`：全站通用资源（jQuery、Slick、Magnific Popup、通用样式）
- `css/`：现代化主站样式（模块化、可组合）
- `js/`：主站脚本（主页动画、rollover、顶部锚点等）
- `images/`：通用图片资源
- `ftr/`：页脚相关样式与图片（历史保留）
- `backup_original/`：关键文件备份（集成现代 CSS 前）
- 开发/运维与质量相关：`dev_server.py`、各类清理与现代化脚本、性能报告与指南文档

### 技术栈与兼容
- 原站前端：原生 JavaScript + jQuery 1.9.x；图廊/弹窗与轮播依赖 Slick、Magnific Popup
- 现代化样式：CSS Variables、Flexbox、Grid、动画与工具类体系（兼容旧 CSS）
- 浏览器支持：现代浏览器为主，保留旧版 IE 相关的回退逻辑与 `common/js/common.js`（IE6-9）

### CSS 架构（`css/`）
- 主入口：`css/main.css`（集中引入 variables、responsive、layout、components、utilities、animations、modern-features）
- 模块：
  - `variables.css`：设计系统（颜色、字体等）
  - `responsive.css`：断点与响应式通用规则
  - `layout.css`：容器、Flex/Grid、间距与布局工具类
  - `components.css`：按钮/卡片/导航/徽章等基础组件
  - `utilities.css`：通用工具类（显示、间距、对齐、尺寸、定位等）
  - `animations.css`、`modern-features.css`：动画与现代特性
  - `compatibility.css`、`layout-fixes.css`：与旧站风格的兼容增强
  - `min/`：上述文件的压缩版本
- 栏目样式：`style/css/*.css`（栏目定制样式，保留原有结构）

引入方式（推荐）：
```html
<link rel="stylesheet" href="/css/main.css">
<!-- 按需再引入栏目样式，如： -->
<link rel="stylesheet" href="/style/css/science.css">
```

### JavaScript 组件
- `common/js/jquery-1.9.1.min.js`：jQuery 核心
- `common/js/slick.min.js`：轮播
- `common/js/jquery.magnific-popup.js`、`jquery.colorbox-min.js`：弹出框/图廊
- `common/js/common.js`：旧站通用逻辑（浏览器检测、图片翻转 `_n.`/`_o.`、工具函数等）
- `js/index.js`：首页动画与 IE6 PNG 兼容处理
- `js/rollover.js`、`js/page-top.js`、`js/debug.js`：图片翻转、返回顶部、开发调试

图片翻转约定：普通态 `_n.`，悬停态 `_o.`（由 `common.js` 处理）。

### 开发与预览
- 开发服务器（热重载）：`dev_server.py`
  - 访问：
    - 现代特性演示: http://localhost:8189/modern_features_demo.html
    - 性能优化版本: http://localhost:8189/performance_optimized.html
    - 实际网站入口: http://localhost:8189/dev_index.html
    - 状态检查: http://localhost:8189/__dev__/status
  - 热重载：监控 `.html/.css/.js/.json` 文件改动
  - 调试工具：页面内 `Ctrl+Shift+D` 触发，或使用 `js/debug.js` 暴露的 `debug.*` API
- 快速开始：
```bash
python dev_server.py --open  # 启动后自动打开浏览器
```

### 构建与部署
- 构建产物脚本：`build.py`
  - 输出目录：`dist/`
  - 拷贝 HTML/CSS/JS/图片并生成 `.gz` 版本
- 性能与产物生成：`performance_optimization.py`
  - 生成与更新：`performance_optimized.html`、`css/critical.css`、`css/min/*`、`PERFORMANCE_REPORT.md`、`build.py`
- Cloudflare Pages：`CLOUDFLARE_DEPLOY.md`
  - 无构建命令、根目录部署；亦可压缩包直接上传（排除 `.py`、`.md` 等）

### 现代化与本地化改造（完成情况）
- HTML 现代化：`modernize_html.py`、`fix_html_structure.py`、`fix_accessibility.py`
  - 移除 `bgcolor/marginheight/cellpadding/cellspacing/align/valign` 等弃用属性
  - `center` → 语义化容器 + 对应 CSS；布局表格标注 `role="presentation"`
  - 鼠标事件补充键盘等效，基础可访问性增强
  - 详见：`HTML_MODERNIZATION_REPORT.md`
- 本地化清理：`cleanup_site.py`、`final_cleanup.py`、`remove_meiji_common.py`、`remove_footer.py`、`fix_remaining_links.py`
  - 移除 Google Tag Manager/Analytics、OneTrust、广告与跟踪脚本
  - 清理明治共通注释/链接与复杂页脚，仅保留中文版权与必要信息
  - 修复残留外链、语言切换与 spacer 资源
- CSS 架构优化：`optimize_css_structure.py`、`integrate_modern_css.py`、`implement_flexbox_grid.py`
  - 建立模块化体系与工具类库；对栏目样式做 Flex/Grid 渐进增强
  - 向实际页面注入现代 CSS 与调试工具，同时备份原始文件至 `backup_original/`
- 性能：`PERFORMANCE_REPORT.md`（总 CSS 体积与压缩效果、加载策略、关键路径 CSS、缓存策略）

### 内容与信息架构
- 实验室（`laboratory/`）
  - 研究报告（菌株：`LB81`、`OLL2716`、`1073R-1`、`PA-3`、`OLL2712`、`OLL1251` 等；`genome`/`lactobacillus`/`intestinal_bacteria`）
  - 研究者（`mechnikov`、`mitsuoka` 等）
  - 世界酸奶文化（区域与国家分类）
- 风采（`style/`）
  - 美容与健康（`beauty/`）
  - 科学验证（`science/`）
  - 早餐“肠食”（`choshoku/`）
- 词典（`style/dictionary/`）

### 常见维护任务
- 调整样式
  - 修改 `css/layout.css`/`components.css`/`utilities.css` 等通用文件；栏目差异在 `style/css/*.css`
  - 移动端适配优先修改 `css/responsive.css` 与各栏目文件的移动端分支
- 新增页面/栏目
  - 复制相近目录结构下的 `index.html` 并更新资源相对路径
  - 推荐引入 `css/main.css` 与所需栏目 CSS；如需调试，保留开发注入段（`integrate_modern_css.py` 已示例）
- 图片翻转与悬停
  - 依旧遵循 `_n.`/`_o.` 命名；轮播与弹窗遵循 Slick/Magnific Popup 初始化方式

### 重要约定与注意
- 路径：全站采用相对路径；部署在任意子路径时无需调整根路径
- 旧版浏览器逻辑：`common/js/common.js` 内含 IE6-9 兼容与图片翻转等逻辑，尽量避免大范围修改
- 可访问性：布局表格请保持 `role="presentation"`；交互元素确保键盘可达与焦点可见
- 性能：生产部署使用 `css/min/*.min.css`；必要时启用 `css/critical.css` 的关键路径内联策略（参考性能模板）

### 开发调试清单
- 启动热重载服务器并打开调试页面
- `Ctrl+Shift+D` 显示工具栏（网格/容器/断点/性能）
- 在控制台使用：
```js
debug.highlight('.card');
debug.measure('.container');
debug.inspect('.btn-primary');
```

### 构建与发布清单
- 本地验证：全站主要入口与栏目首页加载正常，无 404、无控制台报错
- 构建：
```bash
python performance_optimization.py  # 生成/刷新性能产物与报告
python build.py                     # 生成 dist/（含 .gz）
```
- Cloudflare Pages：参考 `CLOUDFLARE_DEPLOY.md` 配置“无构建命令、根目录为 /”，或上传压缩包

### 后续建议
- 渐进迁移栏目内的 `float` 布局为 Flex/Grid，减少历史样式耦合
- 分页与导航的可访问性微调（ARIA、焦点管理）
- 图片资源采用现代格式（WebP/AVIF）与懒加载（模板已示例）
- 统一导航与页脚组件（在不影响既有内容前提下）

### 关键文件速查
- 开发：`dev_server.py`、`dev_index.html`、`DEV_GUIDE.md`、`CSS_GUIDE.md`
- 现代化与清理：`integrate_modern_css.py`、`cleanup_site.py`、`final_cleanup.py`、`modernize_html.py`
- 构建与性能：`build.py`、`performance_optimization.py`、`PERFORMANCE_REPORT.md`
- 部署：`CLOUDFLARE_DEPLOY.md`
